Ã³
    Ã–EÃ˜gÂ»  Ã£                   Ã³D   â€¢ S SK r S SKrS SKJr  S SKrS SKr " S S5      rg)Ã©    N)Ãšdatetimec                   Ã³L   â€¢ \ rS rSrSS jrS
S jrS rS r S  rS r	S	 r
S
 r
S
rg)Ãš
SimpleSIEMÃ©    c                  Ã³â‚¬   â€¢ / U l         / U l        Xl        SU l        S U l        SSSS.SS SS.S	S
S
S.SS
SS.S.U l        g )NTzlogin failedÃ©   Ã©<   )Ãš patternÃš	thresholdÃš
time_windowz192\.168\.\d+\.\d+Ã©   iX  z(viewed data|downloaded data)Ã©
   Ã©,  zunauthorized attemptÃ©   i  )Ãšmultiple_failed_loginsÃš
suspicious_ipÃš
rapid_actionsÃšunauthorized_access)ÃšlogsÃšalertsÃšlog_fileÃš runningÃšcurrent_userÃšrules)Ãšselfr   s     ÃšIc:\Personal Files\extra\SIEM Project\siem2\SIEM_Tool_Project\siem\core.pyÃš__init__ÃšSimpleSIEM.__init__   s_   â‚¬ Ã˜Ë†Å’	Ã˜Ë†Å’
Ã˜ Å’
Ã˜Ë†Å’Ã˜ Ë†Ã”Ã° 3BÃPQÃbdÃ‘&eÃ˜)>ÃˆQÃ_bÃ‘cÃ˜)IÃXZÃknÃ‘oÃ˜/FÃUVÃgkÃ‘#lÃ±	
Ë†Â
Ã³    Nc                 Ã³
  â€¢ [         R                  " 5       R                  5       nUUU=(       d    U R                  =(       d    SSS.nU R                  R
                  U5        U R
                  U5        U R                  U5        g )NÃš unknownF)Ãš	timestampÃš messageÃšuserÃš	processed)r   ÃšnowÃš	isoformatr   r   ÃšappendÃšappend_log_to_fileÃš
analyze_log)r   Ãš	log_entryr$   r"   Ãšlogs        r   Ãš
collect_logÃšSimpleSIEM.collect_log   si   â‚¬ Ãœâ€”Lâ€™Lâ€œNÃ—,Ã‘,Ã“.Ë†	Ã "Ã˜ Ã˜Ã—:ËœDÃ—-Ã‘-Ã—:Â°Ã˜Ã±	
Ë†Ã° 	
Â	â€°	Ã—Ã‘ËœÃ”Ã˜Ã—Ã‘Â Ã”$Ã˜Ã—Ã‘ËœÃ•r   c                 Ã³Ã”   â€¢ U R                   R                  5        HJ  u  p#[        R                  " US   US   [        R                  5      (       d  M8  U R
                  X#U5        ML  
   g )Nr
   r#   )r   ÃšitemsÃšreÃšsearchÃš
IGNORECASEÃšcheck_rule_violation)r   r,   Ãš	rule_nameÃšrules       r   r*   ÃšSimpleSIEM.analyze_log"   sJ   â‚¬ Ã˜#Å¸zâ„¢zÃ—/Ã‘/Ã–1â€°OË†IÃœÂyÅ yËœËœiâ„¢Â¨#Â¨iÂ©.Â¼"Â¿-Â¹-Ã—HÃ“HÃ˜Ã—)Ã‘)Â¨)Â¸3Ã–?Ã²  2r   c                 Ã³Ãˆ  â€¢ [         R                  " US   5      nUR                  5       US   -
  nU R                   Vs/ s Hs  n[         R                  " US   5      R                  5       U:Â¼  d  M0  [        R
                  " US   US   [        R                  5      (       d  Mc  US   US   :X  d  Mq  UPMu  
   n n[        U 5      US   :Â¼  a  U R                  X5        g g s  snf ) Nr"   r   r
   r#   r$   r
   )	r   Ãš
fromisoformatr"   r   r1   r2   r3   ÃšlenÃšgenerate_alert)r   r5   r6   Ãš
current_logÃšcurrent_timeÃštime_window_startr,   Ãš matchess           r   r4   ÃšSimpleSIEM.check_rule_violation'   sÃ›   â‚¬ ÃœÃ—-Ã’-Â¨kÂ¸+Ã‘.FÃ“GË†Ã˜(Ã—2Ã‘2Ã“4Â°tÂ¸MÃ‘7JÃ‘JÃÃ°  Å¸9Å¡9Ã³
Ãš$ÂCÃœÃ—&Ã’&Â sÂ¨;Ã‘'7Ã“8Ã—BÃ‘BÃ“DÃHYÃ‘YÃ³ 
Ã¤â€”	â€™	Ëœ$Ëœyâ„¢/Â¨3Â¨yÂ©>Â¼2Â¿=Â¹=Ã—IÃ³ 
Ã° ÂFâ€˜
Ëœ{Â¨6Ã‘2Ã‘2Ã·  
â„¢9Ã° 	Ã° 
Ã´ Ë†wâ€¹<Ëœ4Â 
Ã‘,Ã“
,Ã˜Ã—Ã‘Â 	Ã•3Ã° -Ã¹Ã²
s   Â¾/CÃ1/CÃ‚$
CÃ‚2Cc           
      Ã³Å“  ^^â€¢ [         R                  " 5       R                  5       T[         U5      U R                  T   S   S-  :â€  a  SOSUS   S   [         U5      US S   Vs/ s H   o3S   PM	  
   snS	.m[
        UU4S
 jU R                   5       5      (       d-  U R                  R                  T5        U R                  T5        g g s  snf )
Nr
   g      Ã¸?ÃšHIGHÃšMEDIUMr   r$   Ã©Ã»Ã¿Ã¿Ã¿r#   )r"   r6   Ãšseverityr$   ÃšcountÃš detailsc              3   Ã³Ã   >#   â€¢ U  Hb  nUS    T:H  =(       aN    US   TS   :H  =(       a<    [         R                  " 5       [         R                  " US   5      -
  R                  S:  v â€¢  Md  
   g7f)r6   r$   r"   r   N)r   r&   r9   Ãš seconds)Ãš.0ÃšaÃšalertr5   s     â‚¬â‚¬r   Ãš	<genexpr>Ãš,SimpleSIEM.generate_alert.<locals>.<genexpr>?   sk   Ã¸Ã© â‚¬ Ã° (Ã¢&ÂaÃ° ÂVâ€˜9Â 	Ã‘)Ã· ZÂ¨aÂ°Â©iÂ¸5Ã€Â¹=Ã‘.HÃ· ZÃœâ€”<â€™<â€œ>Â¤HÃ—$:Ã’$:Â¸1Â¸[Â¹>Ã“$JÃ‘JÃ—SÃ‘SÃVYÃ‘YÃ´ZÃ¢&Ã¹s   Æ’A*A-)	r   r&   r'   r:   r   Ãšanyr   r(   Ãš
display_alert)r   r5   Ãšmatched_logsr,   rL   s    `  @r   r;   ÃšSimpleSIEM.generate_alert5   sÃƒ   Ã¹â‚¬ Ã¤!Å¸Å¡â€ºÃ—1Ã‘1Ã“3Ã˜Ãœ"%Â lÃ“"3Â°dÂ·jÂ±jÃ€Ã‘6KÃˆKÃ‘6XÃ[^Ã‘6^Ã“"^â„¢ÃdlÃ˜ Â â€˜OÂ FÃ‘+ÃœËœÃ“&Ã˜2>Â¸rÂ¸sÃ‘2CÃ“DÃ’2CÂ¨3ËœIÅ“Ã‘2CÃ‘DÃ±
 
Ë†Ã´ Ãµ (Ã Å¸;Å¡;Ã³(Ã· (Ã± (Ã° 
ÂKâ€°KÃ—Ã‘ËœuÃ”%Ã˜Ã—Ã‘ËœuÃ•%Ã°	(Ã¹Ã²  Es   Ã#C	c                 Ã³  â€¢ [        SUS    35        [        SUS    35        [        SUS    35        [        S US    35        [        S	US
    35        [        S
5        US    H  n[        S
U 35        M  
   [        S5        g )Nz$
[!] SUSPICIOUS ACTIVITY DETECTED - r"   zUser: r$   zRule: r6   z
Severity: rE   z
Occurrences: rF   zRecent suspicious events:rG   z  - z2--------------------------------------------------)Ãšprint)r   rL   Ãšdetails      r   rP   ÃšSimpleSIEM.display_alertE   sâ€   â‚¬ Ãœ
Ã5Â°eÂ¸KÃ‘6HÃ5IÃJÃ”KÃœ
ÂÂuËœVâ€˜}ÂoÃ&Ã”'Ãœ
ÂÂuËœVâ€˜}ÂoÃ&Ã”'Ãœ
Â
Ëœ5Â Ã‘,Ã-Ã.Ã”/Ãœ
Â
ËœeÂ Gâ„¢nÃ-Ã.Ã”/Ãœ
Ã)Ã”*Ã˜ËœIÃ”&Ë†FÃœÂDËœËœÂ/Ã–"Ã± 'Ã¤
Ë†hÂr   c                 Ã³   â€¢  [        U R                  S5       nUR                  [        R                  " U5      S-   5        S S S 5        g ! , (       d  f       g = f! [
          a  n[
        SU 35         S nAg S nAff = f)NrK   Ãš
zError writing log to file: ) Ãšopenr   ÃšwriteÃšjsonÃšdumpsÃš	ExceptionrT   )r   r,   ÃšfÃšes       r   r)   ÃšSimpleSIEM.append_log_to_fileP   s^   â‚¬ Ã°	5ÃœÂdâ€”mâ€˜mÂ SÃ”)Â¨QÃ˜â€” â€˜ Å“Å¸
Å¡
Â 3â€ºÂ¨$Ã‘.Ã”/Ã· *Ã—)Ã–)Ã»Ã¤Ã³ 	5ÃœÃ/Â°Â¨sÃ3Ã—4Ã‘4Ã»Ã°	5Ãºs4   â€šA Ëœ)A
ÃA Ã

A ÃA ÃA Ã
A=Ã%A8Ã8A=c                 Ã³Â¸  â€¢ [         R                  R                  U R                  5      (       aq   [	        U R                  S5       nU Vs/ s H=  o"R
                  5       (       d  M  [        R                  " UR
                  5       5      PM?  
   snU l        S S S 5        g g s  snf ! , (       d  f       g = f! [          a  n[        SU 35         S nAg S nAff = f)NÃšrzError loading logs: )
ÃšosÃšpathÃšexistsr   rY   Ãšstripr[   Ãšloadsr   r]   rT   )r   r^   Ãšliner_   s       r   Ãš	load_logsÃšSimpleSIEM.load_logsW   sÅ¡   â‚¬ Ãœ

Â7â€°7Â>â€°>Ëœ$Å¸-â„¢-Ã—
(Ã‘
(Ã°
2ÃœËœ$Å¸-â„¢-Â¨Ã”-Â°Ã™FGÃ“ XÃ‚aÂ¸dÃ:Ã‰:Ã<Ã“!9Â¤Â§Â¢Â¨DÂ¯JÂ©JÂ«LÃ–!9ÃaÃ‘ XÂDâ€IÃ· .Ã-Ã° )Ã¹Ã² !YÃ· .Ã•-Ã»Ã¤Ã³ 
2ÃœÃ,Â¨QÂ¨CÃ0Ã—1Ã‘1Ã»Ã°
2ÃºsM   Â°B7 ÃB&Ã
B!Ã'(B!Ã‚B&Ã‚B7 Ã‚!B&Ã‚&
B4 Ã‚0B7 Ã‚4B7 Ã‚7
CÃƒCÃƒC)r   r   r   r   r   r   )z
siem_logs.txt)N)
Ãš__name__Ãš
__module__Ãš__qualname__Ãš__firstlineno__r   r-   r*   r4   r;   rP   r)   ri   Ãš__static_attributes__Â© r   r   r   r       s+   â€  Ã´
Ã´
Ã²@Ã²
4Ã²&Ã² 	Ã²5Ãµ2r   r   )Ãštimer[   r   rc   r1   r   rp   r   r   Ãš<module>rr      s    Ã°Ã› 
Ã› 
Ã Ã› 	Ã› 	Ã·V2Ã² V2r   
